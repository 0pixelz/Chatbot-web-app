<!DOCTYPE html>
<html lang="en" {% if theme == 'dark' %}class="dark"{% endif %}>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for chatbox and input */
        .chat-container {
            max-height: 60vh;
            overflow-y: auto;
            padding: 10px;
        }
        .message {
            margin: 10px 0;
            padding: 10px;
            border-radius: 12px;
            max-width: 80%;
            word-wrap: break-word;
            white-space: pre-wrap;
        }
        .message-user {
            background-color: #3b82f6;
            color: white;
            align-self: flex-start;
        }
        .message-assistant {
            background-color: #374151;
            color: white;
            align-self: flex-end;
        }
        .message-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding-bottom: 20px;
        }
        .input-box {
            border-radius: 20px;
            padding: 12px;
            border: 1px solid #ccc;
            width: 90%;
            margin: 0 auto;
            resize: none;
            background-color: #2d3748;
            color: white;
        }
        .input-box:focus {
            outline: none;
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

    <!-- Navbar & Sidebar -->
    <div class="flex justify-between items-center p-4 bg-gray-800">
        <div class="flex items-center">
            <button onclick="toggleSidebar()" class="text-gray-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
            </button>
            <h1 class="text-xl font-semibold ml-2">Chatbot</h1>
        </div>
        <div>
            {% if session.get('user_picture') %}
                <img src="{{ session['user_picture'] }}" alt="Avatar" class="w-10 h-10 rounded-full cursor-pointer" onclick="toggleMenu()">
            {% else %}
                <div class="w-10 h-10 rounded-full bg-gray-400 text-white flex items-center justify-center cursor-pointer" onclick="toggleMenu()">G</div>
            {% endif %}
        </div>
    </div>

    <!-- Sidebar -->
    <div id="sidebar" class="hidden bg-gray-800 p-4 w-64 h-full absolute left-0 top-0 z-50">
        <h2 class="text-lg font-bold mb-4 text-white">Menu</h2>
        <a href="/chat" class="block mb-2 text-blue-400 hover:underline">Chat</a>
        <a href="/settings" class="block mb-2 text-blue-400 hover:underline">Settings</a>
        <button onclick="startNewChat()" class="block mb-2 text-blue-400 hover:underline">Start New Chat</button>
    </div>

    <!-- Chat Container -->
    <div class="flex flex-col items-center">
        <div id="chatArea" class="chat-container w-full md:w-2/3">
            <div class="message-container" id="messages"></div>
        </div>
        <div class="w-full md:w-2/3 p-4">
            <textarea id="messageInput" class="input-box" placeholder="Type your message..." rows="2" oninput="adjustTextareaHeight()"></textarea>
            <div class="flex justify-between mt-4">
                <button id="sendButton" class="bg-blue-600 hover:bg-blue-700 px-6 py-2 rounded-lg text-white" onclick="sendMessage()" disabled>Send</button>
                <button id="stopButton" class="bg-red-600 hover:bg-red-700 px-6 py-2 rounded-lg text-white hidden" onclick="stopTyping()">Stop</button>
            </div>
        </div>
    </div>

    <!-- Hamburger Menu and Logout Menu -->
    <div id="menu" class="hidden absolute top-16 right-4 bg-gray-800 text-white py-2 px-4 rounded-lg">
        <a href="/logout" class="block px-4 py-2 hover:bg-gray-600">Logout</a>
        <a href="/settings" class="block px-4 py-2 hover:bg-gray-600">Settings</a>
    </div>

    <script>
        // Toggle Sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('hidden');
        }

        // Toggle Avatar Menu
        function toggleMenu() {
            const menu = document.getElementById('menu');
            menu.classList.toggle('hidden');
        }

        // Scroll to Bottom
        function scrollToBottom() {
            const chatArea = document.getElementById('chatArea');
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        // Adjust Textarea Height
        function adjustTextareaHeight() {
            const textarea = document.getElementById('messageInput');
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }

        // Send Message Function
        function sendMessage() {
            const message = document.getElementById('messageInput').value;
            if (message.trim()) {
                addMessage(message, 'user');
                document.getElementById('messageInput').value = '';
                simulateAIResponse(message);
                scrollToBottom();
            }
        }

        // Simulate AI Response (Replace with actual AI call)
        function simulateAIResponse(message) {
            addMessage('I am responding to: ' + message, 'assistant');
            setTimeout(() => {
                addMessage('Here is my full response!', 'assistant');
                scrollToBottom();
            }, 2000);
        }

        // Add Message to Chat
        function addMessage(content, role) {
            const messageContainer = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', role === 'user' ? 'message-user' : 'message-assistant');
            messageDiv.textContent = content;
            messageContainer.appendChild(messageDiv);
        }

        // Stop Typing Animation
        function stopTyping() {
            document.getElementById('stopButton').classList.add('hidden');
        }
    </script>
</body>
</html>

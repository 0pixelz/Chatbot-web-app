<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Calendar - Personal AI Bot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <style>
    body {
      background-color: #111827;
      color: white;
    }
    #calendar {
      max-width: 1000px;
      margin: 40px auto;
      background-color: #1f2937;
      padding: 20px;
      border-radius: 10px;
    }
    .fc-toolbar-title {
      font-size: 1.5rem;
    }
    .fc-daygrid-day-frame {
      background-color: #1f2937;
    }
    .fc-day-today {
      background-color: #374151 !important;
    }
    .fc-button {
      background-color: #374151 !important;
      border: none !important;
      color: white !important;
    }
    .fc-button:hover {
      background-color: #4b5563 !important;
    }
  </style>
</head>

<body class="flex flex-col min-h-screen dark bg-gray-900">

<!-- Header -->
<header class="flex items-center justify-between bg-gray-800 p-4 shadow fixed w-full top-0 z-50">
  <a href="/chat" class="text-xl font-bold text-white">← Back to Chat</a>
  <h1 class="text-xl font-bold text-white">Calendar</h1>
  <div></div>
</header>

<!-- Calendar -->
<main class="flex-1 mt-20 p-4">
  <div id="calendar"></div>
</main>

<!-- Add Event Modal -->
<div id="eventModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-gray-800 p-6 rounded-lg w-80">
    <h2 class="text-xl font-bold mb-4 text-white">Add Event</h2>
    <form id="eventForm">
      <input type="text" id="eventTitle" class="w-full p-2 mb-4 rounded bg-gray-700 text-white" placeholder="Event Title" required>
      <input type="date" id="eventDate" class="w-full p-2 mb-4 rounded bg-gray-700 text-white" required>
      <div class="flex justify-end space-x-2">
        <button type="button" onclick="closeModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">Cancel</button>
        <button type="submit" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded">Save</button>
      </div>
    </form>
  </div>
</div>

<!-- Floating Button -->
<button onclick="openModal()" class="fixed bottom-6 right-6 bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-full shadow-lg text-3xl">＋</button>

<script>
let calendar;

document.addEventListener('DOMContentLoaded', function() {
  calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
    initialView: 'dayGridMonth',
    themeSystem: 'standard',
    height: 'auto',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: ''
    },
    events: "/get_events", // Server route
    eventColor: '#6366f1',
    eventTextColor: 'white'
  });
  calendar.render();
});

function openModal() {
  document.getElementById('eventModal').classList.remove('hidden');
}

function closeModal() {
  document.getElementById('eventModal').classList.add('hidden');
}

document.getElementById('eventForm').addEventListener('submit', async function(event) {
  event.preventDefault();
  const title = document.getElementById('eventTitle').value;
  const date = document.getElementById('eventDate').value;
  if (title && date) {
    await fetch('/add_event', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ title, date })
    });
    closeModal();
    calendar.refetchEvents();
  }
});
</script>

</body>
</html>

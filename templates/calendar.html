<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Calendar - Personal AI Bot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .calendar-day {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 2px;
      border-radius: 8px;
      transition: background-color 0.3s;
      cursor: pointer;
    }
    .calendar-day:hover {
      background-color: #4b5563;
    }
    .calendar-today {
      background-color: #3b82f6;
      color: white;
    }
    .calendar-event {
      background-color: #10b981;
      color: white;
      font-size: 0.8rem;
      padding: 2px 6px;
      border-radius: 9999px;
      margin-top: 2px;
    }
  </style>
</head>

<body class="flex flex-col min-h-screen dark bg-gray-900">

<!-- Navbar -->
<header class="flex items-center justify-between bg-gray-800 p-4 shadow fixed w-full top-0 z-50">
  <button onclick="toggleSidebar()" id="menuButton" class="text-2xl text-gray-200 focus:outline-none">
    â˜°
  </button>
  <h1 class="text-xl font-bold text-gray-200">Personal AI Bot - Calendar</h1>
  <a href="/chat" class="text-gray-200 hover:underline">Chat</a>
</header>

<!-- Sidebar -->
<aside id="sidebar" class="fixed top-16 left-0 w-64 h-full bg-gray-800 transform -translate-x-full transition-transform duration-300 ease-in-out z-40 flex flex-col shadow-lg">
  <div class="p-4 text-xl font-bold text-white">Dashboard</div>
  <nav class="flex-1 px-4 space-y-2 overflow-y-auto">
    <a href="/start_new_chat" class="block py-2 text-white hover:underline">âž• Start New Chat</a>
    <a href="/calendar" class="block py-2 text-white hover:underline">ðŸ“… Calendar</a>
  </nav>
</aside>

<!-- Main Calendar -->
<main class="flex-1 p-6 mt-20 text-gray-100">
  <div id="calendar" class="grid grid-cols-7 gap-2"></div>
</main>

<!-- Add Event Modal -->
<div id="eventModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
  <div class="bg-gray-800 p-6 rounded-lg shadow-lg w-80">
    <h2 class="text-xl font-bold mb-4">Add Event</h2>
    <form method="POST">
      <input type="hidden" name="date" id="modalDate">
      <input type="text" name="event" placeholder="Event details" required class="w-full p-2 rounded mb-4 text-black">
      <div class="flex justify-end space-x-2">
        <button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-500 hover:bg-gray-600 rounded">Cancel</button>
        <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded">Save</button>
      </div>
    </form>
  </div>
</div>

<!-- Scripts -->
<script>
function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('-translate-x-full');
}

function openModal(dateStr) {
  document.getElementById('modalDate').value = dateStr;
  document.getElementById('eventModal').classList.remove('hidden');
}

function closeModal() {
  document.getElementById('eventModal').classList.add('hidden');
}

function generateCalendar() {
  const today = new Date();
  const year = today.getFullYear();
  const month = today.getMonth();
  const firstDay = new Date(year, month, 1).getDay();
  const daysInMonth = new Date(year, month + 1, 0).getDate();
  const calendar = document.getElementById('calendar');

  calendar.innerHTML = "";

  // Days of week
  const weekdays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
  weekdays.forEach(day => {
    const div = document.createElement('div');
    div.className = "text-center font-bold";
    div.innerText = day;
    calendar.appendChild(div);
  });

  // Empty slots before start
  for (let i = 0; i < firstDay; i++) {
    const emptyDiv = document.createElement('div');
    calendar.appendChild(emptyDiv);
  }

  // Days
  for (let d = 1; d <= daysInMonth; d++) {
    const dateStr = `${year}-${String(month+1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
    const dayDiv = document.createElement('div');
    dayDiv.className = "calendar-day";

    {% for date, events_list in events.items() %}
      if (dateStr === "{{ date }}") {
        dayDiv.innerHTML = `
          <div class="calendar-today">${d}</div>
          <div class="calendar-event">{{ events_list|length }} event{{ 's' if events_list|length > 1 else '' }}</div>
        `;
      }
    {% endfor %}

    if (!dayDiv.innerHTML) {
      dayDiv.innerText = d;
    }

    if (year === today.getFullYear() && month === today.getMonth() && d === today.getDate()) {
      dayDiv.classList.add('calendar-today');
    }

    dayDiv.onclick = () => openModal(dateStr);
    calendar.appendChild(dayDiv);
  }
}

window.onload = function() {
  generateCalendar();
}
</script>

</body>
</html>
